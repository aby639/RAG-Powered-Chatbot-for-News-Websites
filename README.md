# Voosh RAG Chatbot

A minimal news Q&A app that ingests RSS articles, stores chunk embeddings in **Qdrant**, and answers user questions with **Gemini** grounded to retrieved passages. Per-session chat history is kept in **Redis** (Upstash REST) or an in-memory fallback.

## 🔗 Live Demo

- **Frontend:** https://voosh-rag-frontend-6zax.onrender.com  
- **Backend base URL:** https://voosh-rag-backend-m0qa.onrender.com  
  - Health: `/health` → `{ "ok": true }`  
  - Stats: `/api/stats` → `{ "docs": 229, "lastIngestAt": "..." }`

> Note: Free Render instances may cold-start; first request can take ~30–60s.

---

## ✨ Features

- **RAG pipeline:** RSS → fetch → split → **Jina embeddings** → **Qdrant** (vector DB)
- **Express backend:** `/api/session/new`, `/api/chat`, `/api/history/:id`, `/api/reset/:id`, `/api/stats`, `/health`
- **React + Vite + SCSS frontend:** chat bubbles, citations, typing dots, session reset
- **Config via `.env` / `.env.example`** for easy setup
- **Redis history:** Upstash REST (falls back to in-memory if not configured)

---

## 🧱 Stack

- **Backend:** Node 18+, Express, Axios, Qdrant HTTP, Jina embeddings API, Google Gemini
- **Frontend:** React + Vite + SCSS
- **Vector DB:** Qdrant (Cloud HTTP)
- **Cache/History:** Upstash Redis REST (optional)

---

## 📁 Repo Structure

voosh-rag-backend/
├─ src/server.js
├─ ingest/
│ ├─ fetch_seeds.py # RSS → seed_urls.txt
│ ├─ ingest.py # fetch → split → embed → upsert to Qdrant
│ └─ requirements.txt
├─ seed_urls.txt # generated by fetch_seeds.py
├─ .env # (not committed)
├─ .env.example # sample env (commit safe)
└─ package.json
voosh-rag-frontend/
├─ src/App.jsx
├─ src/styles/app.scss
├─ index.html
├─ .env # (not committed)
├─ .env.example # sample env (commit safe)
└─ package.json


---

## ⚙️ Environment Variables

### Backend (`voosh-rag-backend/.env.example`)

CORS

ORIGIN=https://voosh-rag-frontend-6zax.onrender.com

Qdrant

QDRANT_URL=https://your-qdrant-endpoint
 # No trailing slash
QDRANT_API_KEY=<qdrant_api_key>

Embeddings (Jina)

JINA_API_KEY=<jina_api_key>

LLM (Gemini)

GEMINI_API_KEY=<gemini_api_key>

Retrieval / ranking

TOP_K=5

Upstash Redis REST (optional)

UPSTASH_REDIS_REST_URL=https://us1-cool.upstash.io
 # No trailing slash
UPSTASH_REDIS_REST_TOKEN=<redis_rest_token>


### Frontend (`voosh-rag-frontend/.env.example`)

Point the UI to the API base

VITE_API_URL=https://voosh-rag-backend-m0qa.onrender.com


> **No trailing slash** means: `https://api.example.com` ✔️ **not** `https://api.example.com/` ❌

---

## 🧪 API Quick Reference

**Create session**


POST /api/session/new
→ { "sessionId": "<uuid>" }


**Chat**


POST /api/chat
Body:
{
"sessionId": "<uuid>",
"message": "bbc"
}

→ {
"answer": "…grounded answer…",
"sources": [
{ "id": 1, "title": "…", "url": "https://…" }
]
}


**History**


GET /api/history/:id
→ { "messages": [ { role, content }, ... ] }


**Reset session**


POST /api/reset/:id
→ { "ok": true }


**Stats**


GET /api/stats
→ { "docs": 229, "lastIngestAt": "…" }


**Health**


GET /health
→ { "ok": true }


---

## 🧰 Local Development

**Prereqs**
- Node.js **18+** and npm
- Python **3.10+** (`pip`)
- Accounts/Keys: **Jina** (embeddings), **Gemini** (LLM), **Qdrant** (Cloud HTTP), **Upstash Redis** (optional)

**1) Backend**
```bash
cd voosh-rag-backend
cp .env.example .env   # fill keys

# ingest deps
pip install -r ingest/requirements.txt

# optional: fetch fresh RSS → seed_urls.txt
python ingest/fetch_seeds.py

# ingest URLs → Qdrant (split, embed, upsert)
python ingest/ingest.py

# run api
npm install
npm run dev  # http://localhost:8080


2) Frontend

cd voosh-rag-frontend
cp .env.example .env   # ensure VITE_API_URL points to backend
npm install
npm run dev  # http://localhost:5173


Open the app and try: bbc, mining in zambia, tottenham.

☁️ Deploy (Render)
Backend — Web Service

Root Directory: voosh-rag-backend

Build Command: npm ci

Start Command: npm start

Health Check: /health

Env Vars: set from .env.example (no trailing slashes)

Instance: Free (OK for demo; cold starts expected)

Frontend — Static Site

Root Directory: voosh-rag-frontend

Build Command: npm ci && npm run build

Publish Directory: dist

Env Vars: VITE_API_URL = your backend URL

📝 Notes

Answers are grounded to retrieved passages. If no match meets MIN_SCORE, the server returns “Unsure” (+ links), or (if enabled) an off-corpus Gemini answer labeled accordingly.

History uses Upstash Redis when configured; otherwise in-memory fallback (demo).

Ingest uses stable chunk IDs (URL + chunk index) to avoid duplicate upserts.

UI is desktop-first; mobile is functional, with minor spacing tweaks pending.

🧯 Troubleshooting

Cold starts / 502: Free Render spins down; first request may take ~60s.

CORS: Ensure backend ORIGIN matches your frontend URL (no trailing slash).

Qdrant auth: Double-check QDRANT_URL and QDRANT_API_KEY.

Empty results: Run python ingest/fetch_seeds.py then python ingest/ingest.py. Check /api/stats.

Redis not set: Falls back to in-memory. For persistence, set UPSTASH_REDIS_REST_URL + UPSTASH_REDIS_REST_TOKEN.

🔒 .gitignore (root)
# env
.env
voosh-rag-backend/.env
voosh-rag-frontend/.env

# deps / build
node_modules/
dist/
.vite/

# logs
npm-debug.log*
yarn-debug.log*
pnpm-debug.log*

# editors/OS
.vscode/
.idea/
.DS_Store
Thumbs.db


