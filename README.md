# Voosh RAG Chatbot

A minimal news Q\&A app that ingests RSS articles, stores chunk embeddings in **Qdrant**, and answers user questions with **Gemini** grounded to retrieved passages. Per-session chat history is kept in **Redis** (Upstash REST) or an in-memory fallback.

> Note: Free Render instances may cold-start; the first request can take \~30–60s.

---

## Live Demo

* **Frontend:** [https://voosh-rag-frontend-6zax.onrender.com](https://voosh-rag-frontend-6zax.onrender.com)
* **Backend base URL:** [https://voosh-rag-backend-m0qa.onrender.com](https://voosh-rag-backend-m0qa.onrender.com)

  * Health: `GET /health` → `{"ok": true}`
  * Stats: `GET /api/stats` → `{"docs": 229, "lastIngestAt": "2025-09-18T18:36:05Z"}`

---

## Features

* RAG pipeline: RSS → fetch → split → **Jina embeddings** → **Qdrant** (vector DB)
* Express backend: `POST /api/session/new`, `POST /api/chat`, `GET /api/history/:id`, `POST /api/reset/:id`, `GET /api/stats`, `GET /health`
* React + Vite + SCSS frontend: chat bubbles, citations, typing dots, session reset
* Config via `.env` / `.env.example`
* Redis history via Upstash REST (optional; falls back to in-memory)

---

## Stack

* **Backend:** Node 18+, Express, Axios, Qdrant HTTP, Jina embeddings API, Google Gemini
* **Frontend:** React + Vite + SCSS
* **Vector DB:** Qdrant (Cloud HTTP)
* **Cache/History:** Upstash Redis REST (optional)

---

## Repo Structure

```
voosh-rag-backend/
├─ src/server.js
├─ ingest/
│  ├─ fetch_seeds.py        # RSS → seed_urls.txt
│  ├─ ingest.py             # fetch → split → embed → upsert to Qdrant
│  └─ requirements.txt
├─ seed_urls.txt            # generated by fetch_seeds.py
├─ .env                     # (not committed)
├─ .env.example             # sample env (safe to commit)
└─ package.json

voosh-rag-frontend/
├─ src/App.jsx
├─ src/styles/app.scss
├─ index.html
├─ .env                     # (not committed)
├─ .env.example             # sample env (safe to commit)
└─ package.json

README.md
.gitignore
```

---

## Environment Variables

### Backend (`voosh-rag-backend/.env.example`)

```
# CORS
ORIGIN=https://voosh-rag-frontend-6zax.onrender.com

# Qdrant (no trailing slash in URL)
QDRANT_URL=https://your-qdrant-endpoint
QDRANT_API_KEY=your_qdrant_api_key

# Embeddings (Jina)
JINA_API_KEY=your_jina_api_key

# LLM (Gemini)
GEMINI_API_KEY=your_gemini_api_key

# Retrieval
TOP_K=5

# Upstash Redis REST (optional)
UPSTASH_REDIS_REST_URL=https://us1-yourdb.upstash.io
UPSTASH_REDIS_REST_TOKEN=your_upstash_rest_token
```

### Frontend (`voosh-rag-frontend/.env.example`)

```
# Point the UI to the API base (no trailing slash needed in backend)
VITE_API_URL=https://voosh-rag-backend-m0qa.onrender.com
```

---

## API Quick Reference

### Create session

**POST** `/api/session/new`
*Response:*

```json
{"sessionId": "b7b6b3b8-8d2a-4a34-9b9d-7b3f2d7d2f90"}
```

### Chat

**POST** `/api/chat`
*Request body:*

```json
{"sessionId": "b7b6b3b8-8d2a-4a34-9b9d-7b3f2d7d2f90", "message": "bbc"}
```

*Response:*

```json
{
  "answer": "Grounded answer...",
  "sources": [
    { "id": 1, "title": "Example Article", "url": "https://news.example.com/article" }
  ]
}
```

### History

**GET** `/api/history/:id`
*Response:*

```json
{"messages": [{"role": "user", "content": "..."}, {"role": "assistant", "content": "..."}]}
```

### Reset session

**POST** `/api/reset/:id`
*Response:*

```json
{"ok": true}
```

### Stats

**GET** `/api/stats`
*Response:*

```json
{"docs": 229, "lastIngestAt": "2025-09-18T18:36:05Z"}
```

### Health

**GET** `/health`
*Response:*

```json
{"ok": true}
```

---

## Local Development

**Prereqs**

* Node.js **18+** and npm
* Python **3.10+** (`pip`)
* Accounts/Keys: **Jina** (embeddings), **Gemini** (LLM), **Qdrant** (Cloud), **Upstash Redis** (optional)

**1) Backend**

```bash
cd voosh-rag-backend
cp .env.example .env   # fill keys

# ingest deps
pip install -r ingest/requirements.txt

# optional: fetch fresh RSS → seed_urls.txt
python ingest/fetch_seeds.py

# ingest URLs → Qdrant (split, embed, upsert)
python ingest/ingest.py

# run api
npm install
npm run dev  # http://localhost:8080
```

**2) Frontend**

```bash
cd voosh-rag-frontend
cp .env.example .env   # ensure VITE_API_URL points to backend
npm install
npm run dev  # http://localhost:5173
```

Open the app and try prompts like: `bbc`, `mining in zambia`, `tottenham`.

---

## Deploy (Render)

### Backend — Web Service

* **Root Directory:** `voosh-rag-backend`
* **Build Command:** `npm ci`
* **Start Command:** `npm start`
* **Health Check Path:** `/health`
* **Env Vars:** set from `.env.example` (no trailing slashes)
* **Instance:** Free (OK for demo; cold starts expected)

### Frontend — Static Site

* **Root Directory:** `voosh-rag-frontend`
* **Build Command:** `npm ci && npm run build`
* **Publish Directory:** `dist`
* **Env Vars:** `VITE_API_URL=<your backend URL>`

---

## Notes

* Answers are grounded to retrieved passages. If no match meets `MIN_SCORE`, the server returns “Unsure” (with links) or, if enabled, an off-corpus Gemini answer labeled accordingly.
* History uses Upstash Redis when configured; otherwise in-memory fallback (demo).
* Ingest uses stable chunk IDs (URL + chunk index) to avoid duplicate upserts.
* UI is desktop-first; mobile works, minor spacing tweaks pending.

---

## Troubleshooting

* **Cold starts / 502**: Free Render spins down; first request may take \~60s.
* **CORS**: Ensure backend `ORIGIN` exactly matches your frontend URL.
* **Qdrant auth**: Double-check `QDRANT_URL` and `QDRANT_API_KEY`.
* **Empty results**: Run `python ingest/fetch_seeds.py` then `python ingest/ingest.py`. Check `/api/stats`.
* **Redis not set**: Falls back to in-memory. For persistence, set `UPSTASH_REDIS_REST_URL` and `UPSTASH_REDIS_REST_TOKEN`.

---

## .gitignore (root)

```
# env
.env
voosh-rag-backend/.env
voosh-rag-frontend/.env

# deps / build
node_modules/
dist/
.vite/

# logs
npm-debug.log*
yarn-debug.log*
pnpm-debug.log*

# editors/OS
.vscode/
.idea/
.DS_Store
Thumbs.db
```

---

want me to also drop a super-short “quickstart” at the very top? happy to add it.
